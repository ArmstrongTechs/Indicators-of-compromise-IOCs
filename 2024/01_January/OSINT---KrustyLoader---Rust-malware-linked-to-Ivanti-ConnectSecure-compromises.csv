+*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-+
| Title: OSINT - KrustyLoader - Rust malware linked to Ivanti ConnectSecure compromises
| UUID: 81866b54-7f4b-42f0-bcc1-84b7d8578e74
| Date: 2024-01-31
"| Author: Armstrong Techs, Research Lab"
| References: https://www.armstrongtechs.com/
| TLP:CLEAR
+*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-+

Date,Category,Type,Value,Comment
2024-01-30,Payload delivery,sha256,47ff0ae9220a09bfad2a2fb1e2fa2c8ffe5e9cb0466646e2a940ac2e0cf55d04,Linux Rust downloader
2024-01-30,Payload delivery,sha256,816754f6eaf72d2e9c69fe09dcbe50576f7a052a1a450c2a19f01f57a6e13c17,Linux Rust downloader
2024-01-30,Payload delivery,sha256,c26da19e17423ce4cb4c8c47ebc61d009e77fc1ac4e87ce548cf25b8e4f4dc28,Linux Rust downloader
2024-01-30,Payload delivery,sha256,c7ddd58dcb7d9e752157302d516de5492a70be30099c2f806cb15db49d466026,Linux Rust downloader
2024-01-30,Payload delivery,sha256,d14122fa7883b89747f273c44b1f71b81669a088764e97256f97b4b20d945ed0,Linux Rust downloader
2024-01-30,Payload delivery,sha256,6f684f3a8841d5665d083dcf62e67b19e141d845f6c13ee8ba0b6ccdec591a01,Linux Rust downloader
2024-01-30,Payload delivery,sha256,a4e1b07bb8d6685755feca89899d9ead490efa9a6b6ccc00af6aaea071549960,Linux Rust downloader
2024-01-30,Payload delivery,sha256,ef792687b8bcd3c03bed4b09c4722bba921536802afe01f7cdb01cc7c3c60815,Linux Rust downloader
2024-01-30,Payload delivery,sha256,76902d101997df43cd6d3ac10470314a82cb73fa91d212b97c8f210d1fa8271f,Linux Rust downloader
2024-01-30,Payload delivery,sha256,e47b86b8df43c8c1898abef15b8b7feffe533ae4e1a09e7294dd95f752b0fbb2,Linux Rust downloader
2024-01-30,Payload delivery,sha256,73657c062a7cc50a3d51853ec4df904bcb291fdc9cdd08eecaecb78826eb49b6,Linux Rust downloader
2024-01-30,Payload delivery,sha256,030eb56e155fb01d7b190866aaa8b3128f935afd0b7a7b2178dc8e2eb84228b0,Linux Rust downloader
2024-01-30,External analysis,attachment,krusty_extractor.py,
2024-01-30,Other,text,Python,
2024-01-30,Other,text,https://github.com/synacktiv/krustyloader-analysis/blob/main/krusty_extractor.py,
2024-01-30,Other,text,Trusted,
2024-01-30,Other,comment,Yara rule that detects Linux KrustyLoader,
2024-01-30,Other,text,all,
2024-01-30,Payload installation,yara,"// KrustyLoader.yar
// Copyright (C) 2024 - Synacktiv, Th√©o Letailleur
// contact@synacktiv.com
//
// This program is free software: you can redistribute it and/or modify
// it under the terms of the GNU Affero General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU Affero General Public License for more details.
//
// You should have received a copy of the GNU Affero General Public License
// along with this program.  If not, see <http://www.gnu.org/licenses/>.

rule Linux_Downloader_KrustyLoader
{
    meta:
        author = ""Theo Letailleur, Synacktiv""
        source = ""Synacktiv""
        status = ""RELEASED""
        sharing = ""TLP:WHITE""
        category = ""MALWARE""
        malware = ""KrustyLoader""
        description = ""Yara rule that detects Linux KrustyLoader""

    strings:
        $tokio_worker = ""TOKIO_WORKER_THREADS""
        $tmpdir = ""/tmp/""

        // Load ""/proc/self/exe"" string
        $proc_self_exe = {
            48 B? 73 65 6C 66 2F 65 78 65 // mov     r64, 6578652F666C6573h
            48 8D B4 24 ?? ?? 00 00       // lea     rsi, [rsp+????h]
            48 89 46 0?                   // mov     [rsi+6], r64
            48 B? 2F 70 72 6F 63 2F 73 65 // mov     r64, 65732F636F72702Fh
            48 89 0?                      // mov     [rsi], r64
        }

        $pipe_suffix = ""|||||||||||||||||||||||||||""

        // AES key expansion
        $aeskeygenassist = {
            660F3ADF0601 // aeskeygenassist xmm0, xmmword ptr [rsi], 1
            660F7F07     // movdqa  xmmword ptr [rdi], xmm0
            C3           // retn
        }

        // AES InvMixColumns
        $aesinvmixcol = {
            660F38DB06  // aesimc  xmm0, xmmword ptr [rsi]
            660F7F07    // movdqa  xmmword ptr [rdi], xmm0
            C3          // retn
        }

    condition:
        uint32(0) == 0x464C457F and
        (
            all of them
        )
}",
2024-01-30,External analysis,link,https://www.synacktiv.com/en/publications/krustyloader-rust-malware-linked-to-ivanti-connectsecure-compromises,
2024-01-30,Other,text,"On 10th January 2024, Ivanti disclosed two zero-day critical vulnerabilities affecting Connect Secure VPN product: CVE-2024-21887 and CVE-2023-46805 allowing unauthenticated remote code execution. Volexity and Mandiant published articles reporting how these vulnerabilities were actively exploited by a threat actor. On 18th January, Volexity published new observations including hashes of Rust payloads downloaded on compromised Ivanti Connect Secure instances. This article presents a malware analysis of these unidentified Rust payloads that I labelled as KrustyLoader.",
2024-01-30,Payload delivery,md5,deff93081ccb3fda7a12f6e9e3ad15ad,
2024-01-30,Payload delivery,sha1,40b88819594091111c93bd9578b82dedd0823362,
2024-01-30,Payload delivery,sha256,030eb56e155fb01d7b190866aaa8b3128f935afd0b7a7b2178dc8e2eb84228b0,
2024-01-30,Payload delivery,tlsh,t147154b07fda204bdd9b9c834861ea273f639b85c421176377bd85b302e25a20df2db95,
2024-01-30,Payload delivery,vhash,1cbe32fb065a3318a29a9156aa4e9083,
2024-01-30,Payload delivery,ssdeep,24576:aR4f424TMgHBwOmA8vzHhyKDnPAzRDLZUaWX:aR4xzgHVmAIHhnDnIR+aWX,
2024-01-30,Payload delivery,md5,322778ac48bb0e0da65c0288b76b1133,
2024-01-30,Payload delivery,sha1,1bc9a9190b86d42f5c74735da669e76a5c7ff6fe,
2024-01-30,Payload delivery,sha256,73657c062a7cc50a3d51853ec4df904bcb291fdc9cdd08eecaecb78826eb49b6,
2024-01-30,Payload delivery,tlsh,t172154b07fda204bdd9b9c834861ea273f639b85c421176377bd85b302e25a20df2db95,
2024-01-30,Payload delivery,vhash,1cbe32fb065a3318a29a9156aa4e9083,
2024-01-30,Payload delivery,ssdeep,24576:aR4f424TMgHBwOmA8vzHhyKDjPAzRDLZUaWX:aR4xzgHVmAIHhnDjIR+aWX,
2024-01-30,Payload delivery,md5,cbf6325a11ba974278f2b9038a4b99d7,
2024-01-30,Payload delivery,sha1,8c7fdcd3a192a37bdbb8e6877a9b8e14c07dd8d5,
2024-01-30,Payload delivery,sha256,e47b86b8df43c8c1898abef15b8b7feffe533ae4e1a09e7294dd95f752b0fbb2,
2024-01-30,Payload delivery,tlsh,t1ba154b07fda204bdd9b9c834861ea273f639b85c421176377bd85b302e25a20df2db95,
2024-01-30,Payload delivery,vhash,1cbe32fb065a3318a29a9156aa4e9083,
2024-01-30,Payload delivery,ssdeep,24576:aR4f424TMgHBwOmA8vzHhyKDRPAzRDLZUaWX:aR4xzgHVmAIHhnDRIR+aWX,
2024-01-30,Payload delivery,md5,5c4cfb6ac2cd3213bace688f0fa2f14e,
2024-01-30,Payload delivery,sha1,913b0c9dc8b30d53ea73911c5683c2dc04c14e3b,
2024-01-30,Payload delivery,sha256,d14122fa7883b89747f273c44b1f71b81669a088764e97256f97b4b20d945ed0,
2024-01-30,Payload delivery,tlsh,t1d8154b07fda204bdd9b9c834861ea273f639b85c421176377bd85b302e25a20df2db95,
2024-01-30,Payload delivery,vhash,1cbe32fb065a3318a29a9156aa4e9083,
2024-01-30,Payload delivery,ssdeep,24576:aR4f424TMgHBwOmA8vzHhyKDWPAzRDLZUaWX:aR4xzgHVmAIHhnDWIR+aWX,
2024-01-30,Payload delivery,md5,4a626140da1009f199afde2581d28d0b,
2024-01-30,Payload delivery,sha1,ba56f6e5b9e7b0137cc237d338471c99480fee96,
2024-01-30,Payload delivery,sha256,6f684f3a8841d5665d083dcf62e67b19e141d845f6c13ee8ba0b6ccdec591a01,
2024-01-30,Payload delivery,tlsh,t116154b07fda204bdd9b9c834861ea273f639b85c421176377bd85b302e25a20df2db95,
2024-01-30,Payload delivery,vhash,1cbe32fb065a3318a29a9156aa4e9083,
2024-01-30,Payload delivery,ssdeep,24576:aR4f424TMgHBwOmA8vzHhyKDkPAzRDLZUaWX:aR4xzgHVmAIHhnDkIR+aWX,
2024-01-30,Payload delivery,md5,d71d37de5bae9a33ce2aa4908178b209,
2024-01-30,Payload delivery,sha1,a19bdf4f7ccc68470c172e67ffe4a1bdef5d7bc4,
2024-01-30,Payload delivery,sha256,a4e1b07bb8d6685755feca89899d9ead490efa9a6b6ccc00af6aaea071549960,
2024-01-30,Payload delivery,tlsh,t1c3154b07fda204bdd9b9c834861ea273f639b85c421176377bd85b302e25a20df2db95,
2024-01-30,Payload delivery,vhash,1cbe32fb065a3318a29a9156aa4e9083,
2024-01-30,Payload delivery,ssdeep,24576:aR4f424TMgHBwOmA8vzHhyKD6PAzRDLZUaWX:aR4xzgHVmAIHhnD6IR+aWX,
2024-01-30,Network activity,url,http://blaze-uk.s3.amazonaws.com/WymRvUz1HeRw3,
2024-01-30,Payload delivery,md5,fc67817ea351dd6f0f0dcdb32a524c54,
2024-01-30,Payload delivery,sha1,f62d0f71441979785b44c8d062fcf7371fa5eb34,
2024-01-30,Payload delivery,sha256,ef792687b8bcd3c03bed4b09c4722bba921536802afe01f7cdb01cc7c3c60815,
2024-01-30,Payload delivery,tlsh,t1b5154b07fda204bdd9b9c834861ea273f639b85c421176377bd85b302e25a20df2db95,
2024-01-30,Payload delivery,vhash,1cbe32fb065a3318a29a9156aa4e9083,
2024-01-30,Payload delivery,ssdeep,24576:aR4f424TMgHBwOmA8vzHhyKDlPAzRDLZUaWX:aR4xzgHVmAIHhnDlIR+aWX,
2024-01-30,Payload delivery,md5,c17113b1361002aff47459eb0d5bfd3b,
2024-01-30,Payload delivery,sha1,61ec1f157f92cd7110b8324689d40e289ea1dc1a,
2024-01-30,Payload delivery,sha256,76902d101997df43cd6d3ac10470314a82cb73fa91d212b97c8f210d1fa8271f,
2024-01-30,Payload delivery,tlsh,t1b2154b07fda204bdd9b9c834861ea273f639b85c421176377bd85b302e25a20df2db95,
2024-01-30,Payload delivery,vhash,1cbe32fb065a3318a29a9156aa4e9083,
2024-01-30,Payload delivery,ssdeep,24576:aR4f424TMgHBwOmA8vzHhyKD1PAzRDLZUaWX:aR4xzgHVmAIHhnD1IR+aWX,
2024-01-30,Network activity,url,http://book4timepublic.s3.amazonaws.com/gEsD2heW4crIT,
2024-01-30,Network activity,url,http://blooming.s3.amazonaws.com/Ea7fbW98CyM5O,
2024-01-30,Payload delivery,md5,63b0574cbe77d6231513f32e0d042484,
2024-01-30,Payload delivery,sha1,55c2197c88cd3cef23b5f9062c6bdbb6f4b28094,
2024-01-30,Payload delivery,sha256,816754f6eaf72d2e9c69fe09dcbe50576f7a052a1a450c2a19f01f57a6e13c17,
2024-01-30,Payload delivery,tlsh,t1f4154b07fda204bdd9b9c834861ea273f639b85c421176377bd85b302e25a20df2db95,
2024-01-30,Payload delivery,vhash,1cbe32fb065a3318a29a9156aa4e9083,
2024-01-30,Payload delivery,ssdeep,24576:aR4f424TMgHBwOmA8vzHhyKDHPAzRDLZUaWX:aR4xzgHVmAIHhnDHIR+aWX,
2024-02-01,Payload delivery,filename,health.py,
2024-02-01,Payload delivery,md5,3045f5b3d355a9ab26ab6f44cc831a83,
2024-02-01,Payload delivery,filename,lastauthserverused.js,
2024-02-01,Payload delivery,md5,8eb042da6ba683ef1bae460af103cc44,
2024-02-01,Payload delivery,filename,lastauthserverused.js,
2024-02-01,Payload delivery,md5,a739bd4c2b9f3679f43579711448786f,
2024-02-01,Payload delivery,filename,lastauthserverused.js,
2024-02-01,Payload delivery,md5,a81813f70151a022ea1065b7f4d6b5ab,
2024-02-01,Payload delivery,filename,lastauthserverused.js,
2024-02-01,Payload delivery,md5,d0c7a334a4d9dcd3c6335ae13bee59ea,
2024-02-01,Payload delivery,filename,lastauthserverused.js,
2024-02-01,Payload delivery,md5,e8489983d73ed30a4240a14b1f161254,
2024-02-01,Payload delivery,filename,category.py,
2024-02-01,Payload delivery,md5,465600cece80861497e8c1c86a07a23e,
