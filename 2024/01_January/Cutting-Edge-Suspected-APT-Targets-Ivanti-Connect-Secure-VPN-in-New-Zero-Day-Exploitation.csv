+*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-+
| Title: Cutting Edge: Suspected APT Targets Ivanti Connect Secure VPN in New Zero-Day Exploitation
| UUID: a9da4722-3b2c-42b6-9bb8-82f2162a171e
| Date: 2024-01-14
"| Author: Armstrong Techs, Research Lab"
| References: https://www.armstrongtechs.com/
| TLP:CLEAR
+*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-+

Date,Category,Type,Value,Comment
2024-01-15,External analysis,link,https://www.mandiant.com/resources/blog/suspected-apt-targets-ivanti-zero-day,
2024-01-15,External analysis,link,https://forums.ivanti.com/s/article/CVE-2023-46805-Authentication-Bypass-CVE-2024-21887-Command-Injection-for-Ivanti-Connect-Secure-and-Ivanti-Policy-Secure-Gateways?language=en_US,
2024-01-15,External analysis,vulnerability,CVE-2023-46805,
2024-01-15,External analysis,vulnerability,CVE-2024-21887,
2024-01-15,Payload delivery,filename,compcheckresult.cgi,Web shell
2024-01-15,Payload delivery,filename,sessionserver.sh,Web shell dropper
2024-01-15,Payload delivery,filename,lastauthserverused.js,Credential harvester
2024-01-15,Payload delivery,filename,visits.py,Web shell
2024-01-15,Payload delivery,filename,sessionserver.pl,Script
2024-01-15,Payload delivery,filename,libsecure.so.1,Passive backdoor
2024-01-15,Network activity,domain,symantke.com,WARPWIRE C2
2024-01-15,Payload installation,yara,"rule M_Hunting_Backdoor_ZIPLINE_1 {

  meta:

    author = ""Mandiant""

    description = ""This rule detects unique strings in ZIPLINE, a passive ELF backdoor that waits for incoming TCP connections to receive commands from the threat actor.""

  strings:

    $s1 = ""SSH-2.0-OpenSSH_0.3xx"" ascii

    $s2 = ""$(exec $installer $@)"" ascii

    $t1 = ""./installer/do-install"" ascii

    $t2 = ""./installer/bom_files/"" ascii

    $t3 = ""/tmp/data/root/etc/ld.so.preload"" ascii

    $t4 = ""/tmp/data/root/home/etc/manifest/exclusion_list"" ascii

  condition:

    uint32(0) == 0x464c457f and

    filesize < 5MB and

    ((1 of ($s*)) or

    (3 of ($t*)))

}",
2024-01-15,Payload installation,yara,"rule M_Hunting_Dropper_WIREFIRE_1 {

  meta:

    author = ""Mandiant""

    description = ""This rule detects WIREFIRE, a web shell written in Python that exists as trojanized logic to a component of the pulse secure appliance.""

    md5 = ""6de651357a15efd01db4e658249d4981""

  strings:

    $s1 = ""zlib.decompress(aes.decrypt(base64.b64decode("" ascii

    $s2 = ""aes.encrypt(t+('\\x00'*(16-len(t)%16))"" ascii

    $s3 = ""Handles DELETE request to delete an existing visits data."" ascii

    $s4 = ""request.data.decode().startswith('GIF'):"" ascii

    $s5 = ""Utils.api_log_admin"" ascii

  condition:

    filesize < 10KB

    and all of them

}",
2024-01-15,Payload installation,yara,"rule M_Hunting_Webshell_LIGHTWIRE_2 {

  meta:

    author = ""Mandiant""

    description = ""Detects LIGHTWIRE based on the RC4 
decoding and execution 1-liner.""

    md5 = ""3d97f55a03ceb4f71671aa2ecf5b24e9""

  strings:

    $re1 = /eval\{my.{1,20}Crypt::RC4->new\(\"".{1,50}->RC4\
(decode_base64\(CGI::param\(\'.{1,30};eval\s\$.{1,30}\""Compatibility
\scheck:\s\$@\"";\}/

  condition:

    filesize < 10KB

    and all of them

}",
2024-01-15,Payload installation,yara,"rule M_Hunting_Dropper_THINSPOOL_1 {

  meta:

    author = ""Mandiant""

    description = ""This rule detects THINSPOOL, a dropper that 
installs the LIGHTWIRE web shell onto a Pulse Secure system.""

    md5 = ""677c1aa6e2503b56fe13e1568a814754""

  strings:

    $s1 = ""/tmp/qactg/"" ascii

    $s2 = ""echo '/home/config/dscommands'"" ascii

    $s3 = ""echo '/home/perl/DSLogConfig.pm'"" ascii

    $s4 = ""ADM20447"" ascii

  condition:

    filesize < 10KB

    and all of them

}",
2024-01-15,Payload installation,yara,"rule M_Hunting_CredTheft_WARPWIRE_1

{

  meta:

    author = ""Mandiant""

    description = ""This rule detects WARPWIRE, a credential stealer 
written in Javascript that is embedded into a legitimate Pulse Secure file.""

    md5 = ""d0c7a334a4d9dcd3c6335ae13bee59ea""

  strings:

    $s1 = {76 61 72 20 77 64 61 74 61 20 3d 20 64 6f 63 75 6d 65 6e 
74 2e 66 72 6d 4c 6f 67 69 6e 2e 75 73 65 72 6e 61 6d 65 2e 76 61 6c 75 65 3b}

    $s2 = {76 61 72 20 73 64 61 74 61 20 3d 20 64 6f 63 75 6d 65 6e 
74 2e 66 72 6d 4c 6f 67 69 6e 2e 70 61 73 73 77 6f 72 64 2e 76 61 6c 75 65 3b}

    $s3 = {2b 77 64 61 74 61 2b 27 26 27 2b 73 64 61 74 61 3b}

    $s4 = {76 61 72 20 78 68 72 20 3d 20 6e 65 77 20 58 4d 4c 48 
74 74 70 52 65 71 75 65 73 74}

    $s5 = ""Remember the last selected auth realm for 30 days"" ascii

  condition:

   filesize < 8KB and 

all of them

}",
2024-01-15,Other,comment,"Ivanti Connect Secure VPN (“CS”, formerly Pulse Secure)",
2024-01-15,Other,comment,Ivanti Policy Secure (“PS”) appliances,
