+*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-+
"| Title: OSINT - Cutting Edge, Part 2: Investigating Ivanti Connect Secure VPN Zero-Day Exploitation"
| UUID: 34237efb-adf4-452b-a322-0cbed70c7b33
| Date: 2024-01-31
"| Author: Armstrong Techs, Research Lab"
| References: https://www.armstrongtechs.com/
| TLP:CLEAR
+*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-+

Date,Category,Type,Value,Comment
2024-02-01,Network activity,domain,symantke.com,WARPWIRE C2 server
2024-02-01,Network activity,domain,miltonhouse.nl,WARPWIRE variant C2 server
2024-02-01,Network activity,domain,entraide-internationale.fr,WARPWIRE variant C2 server
2024-02-01,Network activity,hostname,api.d-n-s.name,WARPWIRE variant C2 server
2024-02-01,Network activity,hostname,cpanel.netbar.org,WARPWIRE variant C2 server
2024-02-01,Network activity,domain,clickcom.click,WARPWIRE variant C2 server
2024-02-01,Network activity,domain,clicko.click,WARPWIRE variant C2 server
2024-02-01,Network activity,domain,duorhytm.fun,WARPWIRE variant C2 server
2024-02-01,Network activity,domain,line-api.com,WARPWIRE variant C2 server
2024-02-01,Network activity,domain,areekaweb.com,WARPWIRE variant C2 server
2024-02-01,Network activity,domain,ehangmun.com,WARPWIRE variant C2 server
2024-02-01,Network activity,domain,secure-cama.com,WARPWIRE variant C2 server
2024-02-01,Network activity,ip-dst,146.0.228.66,WARPWIRE variant C2 server
2024-02-01,Network activity,ip-dst,159.65.130.146,WARPWIRE variant C2 server
2024-02-01,Network activity,ip-dst,8.137.112.245,WARPWIRE variant C2 server
2024-02-01,Network activity,ip-dst,91.92.254.14,WARPWIRE variant C2 server
2024-02-01,Network activity,ip-dst,186.179.39.235,Mass exploitation activity
2024-02-01,Network activity,ip-dst,50.215.39.49,Post-exploitation activity
2024-02-01,Network activity,ip-dst,45.61.136.14,Post-exploitation activity
2024-02-01,Network activity,ip-dst,173.220.106.166,Post-exploitation activity
2024-02-01,External analysis,link,https://www.mandiant.com/resources/blog/investigating-ivanti-zero-day-exploitation,
2024-02-01,Other,text,"On Jan. 12, 2024, Mandiant published a blog post detailing two high-impact zero-day vulnerabilities, CVE-2023-46805 and CVE-2024-21887, affecting Ivanti Connect Secure VPN (CS, formerly Pulse Secure) and Ivanti Policy Secure (PS) appliances. On Jan. 31, 2024, Ivanti disclosed two additional vulnerabilities impacting CS and PS devices, CVE-2024-21888 and CVE-2024-21893.

The vulnerabilities allow for an unauthenticated threat actor to execute arbitrary commands on the appliance with elevated privileges. As previously reported, Mandiant has identified zero-day exploitation of these vulnerabilities in the wild beginning as early as Dec. 3, 2023 by a suspected China-nexus espionage threat actor currently being tracked as UNC5221. 

Mandiant has identified broad exploitation activity following the disclosure of the two vulnerabilities, both by UNC5221 and other uncategorized threat groups. Mandiant assesses that a significant portion of the post-advisory activity has been performed through automated methods.

In this follow-up blog post, we detail additional tactics, techniques, and procedures (TTPs) employed by UNC5221 and other threat groups during post-exploitation activity across our incident response engagements. We also detail new malware families and variants to previously identified malware families being used by UNC5221. We acknowledge the possibility that one or more related groups may be associated with the activity described in this blog post. It is likely that additional groups beyond UNC5221 have adopted one or more of these tools.

These observations have been supported through Mandiant's incident response engagements, working with Ivanti, and our partners. Mandiant is also providing additional recommendations for network defenders, including indicators of compromise (IOCs), and YARA rules.

Note: Ivanti has released its first round of patches starting today, and it is scheduled to continue rolling out additional patches over the coming weeks. Ivanti recommends customers awaiting patches to apply the mitigation, run the external Integrity Checker Tool (ICT) to check for evidence of exploitation, and continue following the KB article to receive product updates as they become available.",
2024-02-01,Other,text,"Cutting Edge, Part 2: Investigating Ivanti Connect Secure VPN Zero-Day Exploitation",
2024-02-01,Other,text,Blog,
2024-02-01,Payload delivery,filename,compcheckresult.cgi,
2024-02-01,Payload delivery,md5,3d97f55a03ceb4f71671aa2ecf5b24e9,
2024-02-01,Payload delivery,filename,health.py,
2024-02-01,Payload delivery,md5,3045f5b3d355a9ab26ab6f44cc831a83,
2024-02-01,Payload delivery,filename,lastauthserverused.js,
2024-02-01,Payload delivery,md5,2ec505088b942c234f39a37188e80d7a,
2024-02-01,Other,text,all,
2024-02-01,Payload installation,yara,"rule M_Hunting_Webshell_BUSHWALK_1 {

  meta:

    author = ""Mandiant""

    description = ""This rule detects BUSHWALK, a webshell written in Perl CGI that is embedded into a legitimate Pulse Secure file to enable file transfers""

 

  strings:

    $s1 = ""SafariiOS"" ascii

    $s2 = ""command"" ascii

    $s3 = ""change"" ascii

    $s4 = ""update"" ascii

    $s5 = ""$data = RC4($key, $data);"" ascii

  condition:

    filesize < 5KB

    and all of them

}",
2024-02-01,Other,text,M_Hunting_Webshell_BUSHWALK_1,
2024-02-01,Other,text,all,
2024-02-01,Payload installation,yara,"rule M_Hunting_Webshell_CHAINLINE_1 {

  meta:

    author = ""Mandiant""

    description = ""This rule detects the CHAINLINE webshell, which receives 
RC4 encrypted commands and returns the execution result""

    md5 = ""3045f5b3d355a9ab26ab6f44cc831a83""

  strings:

    $s1 = ""crypt(command: str)"" ascii

    $s2 = ""tmp[i] = chr(ord(tmp[i])"" ascii

    $s3 = ""ord(RC4_KEY[i % len(RC4_KEY)])"" ascii

    $s4 = ""class Health(Resource)"" ascii

    $s5 = ""crypt(base64.b64decode(command.encode("" ascii

    $s6 = ""base64.b64encode(crypt(result)"" ascii

    $s7 = ""{\""message\"": 'ok', \""stats\"": result}"" ascii

  condition:

    filesize < 100KB and

    any of them

}",
2024-02-01,Other,text,M_Hunting_Webshell_CHAINLINE_1,
2024-02-01,Other,text,all,
2024-02-01,Payload installation,yara,"rule M_HUNTING_APT_Webshell_FRAMESTING_result

{

    meta:

        author = ""Mandiant""

        description = ""Detects strings associated with FRAMESTING webshell""

        md5 = ""465600cece80861497e8c1c86a07a23e""

    strings:

        $s1 = ""exec(zlib.decompress(aes.decrypt(base64.b64decode(data))),{'request':request,'cache'""

        $s2 = ""result={'message':'','action':0}""

 

    condition:

        any of them

}",
2024-02-01,Other,text,M_HUNTING_APT_Webshell_FRAMESTING_result,
2024-02-01,Other,text,all,
2024-02-01,Payload installation,yara,"rule M_Hunting_Webshell_LIGHTWIRE_4 {

  meta:

    author = ""Mandiant""

    description = ""Detects LIGHTWIRE based on the RC4 
decoding and execution 1-liner.""

    md5 = ""3d97f55a03ceb4f71671aa2ecf5b24e9""

  strings:

    $re1 = /eval\{my.{1,20}Crypt::RC4->new\(\"".{1,50}->RC4\(decode_base64\(CGI::param\(\'.{1,30};eval\s\$.{1,30}\""Compatibility\scheck:\s\$@\"";\}/

  condition:

    filesize < 1MB and all of them

}",
2024-02-01,Other,text,M_Hunting_Webshell_LIGHTWIRE_4,
2024-02-01,Other,text,all,
2024-02-01,Payload installation,yara,"rule M_Hunting_CredTheft_WARPWIRE_strings

{

    meta:

        author = ""Mandiant""

        description = ""Detects strings within WARPWIRE credential harvester""

        md5 = ""b15f47e234b5d26fb2cc81fc6fd89775""

    strings:

        $header = ""function SetLastRealm(sValue) {""

 

        // password fields

        $username = ""document.frmLogin.username.value;""

        $password = ""document.frmLogin.password.value;""

 

        // post version

        $btoa = ""btoa(""

        $xhr_post = /xhr.open\(.POST.,( )?url,/

 

        // get version

        $xhr_get = /xhr.open\(.GET.,( )?url,/

        $xhr_send = ""xhr.send(null);""

 

    condition:

        $header in (0..100) 

        and $password in (@username[1]..@username[1]+100)

        and ((#btoa > 1 and $xhr_post) or ($xhr_send in (@xhr_get[1]..@xhr_get[1]+50)))

}",
2024-02-01,Other,text,M_Hunting_CredTheft_WARPWIRE_strings,
